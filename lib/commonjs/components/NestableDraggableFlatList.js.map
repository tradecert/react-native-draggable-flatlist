{"version":3,"names":["NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","useRef","current","LogBox","ignoreLogs","console","reportErrorsAsExceptions","useSafeNestableScrollContainerContext","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","useSharedValue","useState","animVals","setAnimVals","defaultHoverOffset","listHoverOffset","setListHoverOffset","hoverOffset","useDerivedValue","value","useNestedAutoScroll","onListContainerLayout","useStableCallback","containerRef","nodeHandle","onSuccess","_x","y","onFail","log","measureLayout","onDragBegin","params","onDragEnd","onAnimValInit","activationDistance","NestableDraggableFlatList","React","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { LogBox } from \"react-native\";\nimport { FlatList } from \"react-native-gesture-handler\";\n// Animated is needed as an import to generate types for Animated.View which are used inside this\nimport Animated, { useDerivedValue, useSharedValue } from \"react-native-reanimated\";\nimport DraggableFlatList from \"../components/DraggableFlatList\";\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\nimport { DraggableFlatListProps } from \"../types\";\n\nfunction NestableDraggableFlatListInner<T>(props: DraggableFlatListProps<T>, ref?: React.ForwardedRef<FlatList<T>>) {\n  const hasSuppressedWarnings = useRef(false);\n\n  if (!hasSuppressedWarnings.current) {\n    LogBox.ignoreLogs([\n      \"VirtualizedLists should never be nested inside plain ScrollViews with the same orientation because it can break windowing\",\n    ]); // Ignore log notification by message\n    //@ts-ignore\n    console.reportErrorsAsExceptions = false;\n    hasSuppressedWarnings.current = true;\n  }\n\n  const { scrollableRef, outerScrollOffset, setOuterScrollEnabled } = useSafeNestableScrollContainerContext();\n\n  const listVerticalOffset = useSharedValue(0);\n  const [animVals, setAnimVals] = useState({});\n  const defaultHoverOffset = useSharedValue(0);\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\n\n  const hoverOffset = useDerivedValue(() => {\n    return listHoverOffset.value + listVerticalOffset.value;\n  }, [listHoverOffset]);\n\n  useNestedAutoScroll({\n    ...animVals,\n    hoverOffset,\n  });\n\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\n    const nodeHandle = scrollableRef.current;\n\n    const onSuccess = (_x: number, y: number) => {\n      listVerticalOffset.value = y;\n    };\n    const onFail = () => {\n      console.log(\"## nested draggable list measure fail\");\n    };\n    //@ts-ignore\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\n  });\n\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback((params) => {\n    setOuterScrollEnabled(false);\n    props.onDragBegin?.(params);\n  });\n\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback((params) => {\n    setOuterScrollEnabled(true);\n    props.onDragEnd?.(params);\n  });\n\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback((params) => {\n    setListHoverOffset(params.hoverOffset);\n    setAnimVals({\n      ...params,\n      hoverOffset,\n    });\n    props.onAnimValInit?.(params);\n  });\n\n  return (\n    <DraggableFlatList\n      ref={ref}\n      onContainerLayout={onListContainerLayout}\n      activationDistance={props.activationDistance || 20}\n      scrollEnabled={false}\n      {...props}\n      outerScrollOffset={outerScrollOffset}\n      onDragBegin={onDragBegin}\n      onDragEnd={onDragEnd}\n      onAnimValInit={onAnimValInit}\n    />\n  );\n}\n\n// Generic forwarded ref type assertion taken from:\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\nexport const NestableDraggableFlatList = React.forwardRef(NestableDraggableFlatListInner) as <T>(\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\n) => ReturnType<typeof NestableDraggableFlatListInner>;\n"],"mappings":"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"}