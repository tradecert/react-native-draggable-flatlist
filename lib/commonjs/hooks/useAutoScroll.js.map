{"version":3,"names":["useAutoScroll","useRefs","flatlistRef","useProps","autoscrollThreshold","DEFAULT_PROPS","autoscrollSpeed","useAnimatedValues","scrollOffset","scrollViewSize","containerSize","activeCellSize","hoverOffset","activeIndexAnim","touchTranslate","hoverScreenOffset","useDerivedValue","value","isScrolledUp","SCROLL_POSITION_TOLERANCE","isScrolledDown","distToTopEdge","Math","max","distToBottomEdge","hoverPlusActiveCell","isAtTopEdge","isAtBottomEdge","scrollTarget","useSharedValue","dragIsActive","useAnimatedReaction","cur","prev","shouldAutoScroll","scrollTargetDiff","abs","hasScrolledToTarget","isAtEdge","topDisabled","bottomDisabled","isEdgeDisabled","cellIsActive","hasMovedDrag","scrollToInternal","offset","current","scrollToOffset","animated","distFromEdge","speedPct","targetOffset","min","runOnJS"],"sources":["useAutoScroll.tsx"],"sourcesContent":["import { runOnJS, useAnimatedReaction, useDerivedValue, useSharedValue } from \"react-native-reanimated\";\nimport { DEFAULT_PROPS, SCROLL_POSITION_TOLERANCE } from \"../constants\";\nimport { useProps } from \"../context/propsContext\";\nimport { useAnimatedValues } from \"../context/animatedValueContext\";\nimport { useRefs } from \"../context/refContext\";\n\nexport function useAutoScroll() {\n  const { flatlistRef } = useRefs();\n\n  const {\n    autoscrollThreshold = DEFAULT_PROPS.autoscrollThreshold,\n    autoscrollSpeed = DEFAULT_PROPS.autoscrollSpeed,\n  } = useProps();\n\n  const {\n    scrollOffset,\n    scrollViewSize,\n    containerSize,\n    activeCellSize,\n    hoverOffset,\n    activeIndexAnim,\n    touchTranslate,\n  } = useAnimatedValues();\n\n  const hoverScreenOffset = useDerivedValue(() => {\n    return hoverOffset.value - scrollOffset.value;\n  }, []);\n\n  const isScrolledUp = useDerivedValue(() => {\n    return scrollOffset.value - SCROLL_POSITION_TOLERANCE <= 0;\n  }, []);\n\n  const isScrolledDown = useDerivedValue(() => {\n    return scrollOffset.value + containerSize.value + SCROLL_POSITION_TOLERANCE >= scrollViewSize.value;\n  }, []);\n\n  const distToTopEdge = useDerivedValue(() => {\n    return Math.max(0, hoverScreenOffset.value);\n  }, []);\n\n  const distToBottomEdge = useDerivedValue(() => {\n    const hoverPlusActiveCell = hoverScreenOffset.value + activeCellSize.value;\n    return Math.max(0, containerSize.value - hoverPlusActiveCell);\n  }, []);\n\n  const isAtTopEdge = useDerivedValue(() => {\n    return distToTopEdge.value <= autoscrollThreshold;\n  });\n\n  const isAtBottomEdge = useDerivedValue(() => {\n    return distToBottomEdge.value <= autoscrollThreshold;\n  }, []);\n\n  const scrollTarget = useSharedValue(0);\n  const dragIsActive = useDerivedValue(() => {\n    return activeIndexAnim.value >= 0;\n  }, []);\n\n  useAnimatedReaction(\n    () => {\n      return dragIsActive.value;\n    },\n    (cur, prev) => {\n      if (cur && !prev) {\n        scrollTarget.value = scrollOffset.value;\n      }\n    }\n  );\n\n  const shouldAutoScroll = useDerivedValue(() => {\n    const scrollTargetDiff = Math.abs(scrollTarget.value - scrollOffset.value);\n    const hasScrolledToTarget = scrollTargetDiff < SCROLL_POSITION_TOLERANCE;\n\n    const isAtEdge = isAtTopEdge.value || isAtBottomEdge.value;\n    const topDisabled = isAtTopEdge.value && isScrolledUp.value;\n    const bottomDisabled = isAtBottomEdge.value && isScrolledDown.value;\n    const isEdgeDisabled = topDisabled || bottomDisabled;\n\n    const cellIsActive = activeIndexAnim.value >= 0;\n\n    // Only enable auto-scroll if the user has actually moved the drag\n    // This prevents auto-scrolling when starting a drag near an edge\n    // Check touchTranslate (actual finger/mouse movement) not hoverAnim (which includes auto-scroll effects)\n    const hasMovedDrag = Math.abs(touchTranslate.value) > 1;\n\n    return hasScrolledToTarget && isAtEdge && !isEdgeDisabled && cellIsActive && hasMovedDrag;\n  }, []);\n\n  function scrollToInternal(offset: number) {\n    if (flatlistRef && \"current\" in flatlistRef) {\n      flatlistRef.current?.scrollToOffset({ offset, animated: true });\n    }\n  }\n\n  useDerivedValue(() => {\n    if (!shouldAutoScroll.value) return;\n\n    const distFromEdge = isAtTopEdge.value ? distToTopEdge.value : distToBottomEdge.value;\n    const speedPct = 1 - distFromEdge / autoscrollThreshold!;\n    const offset = speedPct * autoscrollSpeed;\n    const targetOffset = isAtTopEdge.value\n      ? Math.max(0, scrollOffset.value - offset)\n      : Math.min(scrollOffset.value + offset, scrollViewSize.value - containerSize.value);\n\n    scrollTarget.value = targetOffset;\n    // Reanimated scrollTo is crashing on android. use 'regular' scrollTo until figured out.\n    // scrollTo(scrollViewRef, targetX, targetY, true);\n    runOnJS(scrollToInternal)(targetOffset);\n  }, []);\n\n  return null;\n}\n"],"mappings":"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"}