{"version":3,"names":["useAutoScroll","useRefs","flatlistRef","useProps","autoscrollThreshold","DEFAULT_PROPS","autoscrollSpeed","useAnimatedValues","scrollOffset","scrollViewSize","containerSize","activeCellSize","hoverOffset","activeIndexAnim","hoverAnim","hoverScreenOffset","useDerivedValue","value","isScrolledUp","SCROLL_POSITION_TOLERANCE","isScrolledDown","distToTopEdge","Math","max","distToBottomEdge","hoverPlusActiveCell","isAtTopEdge","isAtBottomEdge","scrollTarget","useSharedValue","dragIsActive","useAnimatedReaction","cur","prev","shouldAutoScroll","scrollTargetDiff","abs","hasScrolledToTarget","isAtEdge","topDisabled","bottomDisabled","isEdgeDisabled","cellIsActive","hasMovedDrag","scrollToInternal","offset","current","scrollToOffset","animated","distFromEdge","speedPct","targetOffset","min","runOnJS"],"sources":["useAutoScroll.tsx"],"sourcesContent":["import {\n  runOnJS,\n  useAnimatedReaction,\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport { DEFAULT_PROPS, SCROLL_POSITION_TOLERANCE } from \"../constants\";\nimport { useProps } from \"../context/propsContext\";\nimport { useAnimatedValues } from \"../context/animatedValueContext\";\nimport { useRefs } from \"../context/refContext\";\n\nexport function useAutoScroll() {\n  const { flatlistRef } = useRefs();\n\n  const {\n    autoscrollThreshold = DEFAULT_PROPS.autoscrollThreshold,\n    autoscrollSpeed = DEFAULT_PROPS.autoscrollSpeed,\n  } = useProps();\n\n  const {\n    scrollOffset,\n    scrollViewSize,\n    containerSize,\n    activeCellSize,\n    hoverOffset,\n    activeIndexAnim,\n    hoverAnim,\n  } = useAnimatedValues();\n\n  const hoverScreenOffset = useDerivedValue(() => {\n    return hoverOffset.value - scrollOffset.value;\n  }, []);\n\n  const isScrolledUp = useDerivedValue(() => {\n    return scrollOffset.value - SCROLL_POSITION_TOLERANCE <= 0;\n  }, []);\n\n  const isScrolledDown = useDerivedValue(() => {\n    return (\n      scrollOffset.value + containerSize.value + SCROLL_POSITION_TOLERANCE >=\n      scrollViewSize.value\n    );\n  }, []);\n\n  const distToTopEdge = useDerivedValue(() => {\n    return Math.max(0, hoverScreenOffset.value);\n  }, []);\n\n  const distToBottomEdge = useDerivedValue(() => {\n    const hoverPlusActiveCell = hoverScreenOffset.value + activeCellSize.value;\n    return Math.max(0, containerSize.value - hoverPlusActiveCell);\n  }, []);\n\n  const isAtTopEdge = useDerivedValue(() => {\n    return distToTopEdge.value <= autoscrollThreshold;\n  });\n\n  const isAtBottomEdge = useDerivedValue(() => {\n    return distToBottomEdge.value <= autoscrollThreshold;\n  }, []);\n\n  const scrollTarget = useSharedValue(0);\n  const dragIsActive = useDerivedValue(() => {\n    return activeIndexAnim.value >= 0;\n  }, []);\n\n  useAnimatedReaction(\n    () => {\n      return dragIsActive.value;\n    },\n    (cur, prev) => {\n      if (cur && !prev) {\n        scrollTarget.value = scrollOffset.value;\n      }\n    }\n  );\n\n  const shouldAutoScroll = useDerivedValue(() => {\n    const scrollTargetDiff = Math.abs(scrollTarget.value - scrollOffset.value);\n    const hasScrolledToTarget = scrollTargetDiff < SCROLL_POSITION_TOLERANCE;\n\n    const isAtEdge = isAtTopEdge.value || isAtBottomEdge.value;\n    const topDisabled = isAtTopEdge.value && isScrolledUp.value;\n    const bottomDisabled = isAtBottomEdge.value && isScrolledDown.value;\n    const isEdgeDisabled = topDisabled || bottomDisabled;\n\n    const cellIsActive = activeIndexAnim.value >= 0;\n    \n    // Only enable auto-scroll if the user has actually moved the drag\n    // This prevents auto-scrolling when starting a drag near an edge\n    const hasMovedDrag = Math.abs(hoverAnim.value) > 1;\n\n    return hasScrolledToTarget && isAtEdge && !isEdgeDisabled && cellIsActive && hasMovedDrag;\n  }, []);\n\n  function scrollToInternal(offset: number) {\n    if (flatlistRef && \"current\" in flatlistRef) {\n      flatlistRef.current?.scrollToOffset({ offset, animated: true });\n    }\n  }\n\n  useDerivedValue(() => {\n    if (!shouldAutoScroll.value) return;\n\n    const distFromEdge = isAtTopEdge.value\n      ? distToTopEdge.value\n      : distToBottomEdge.value;\n    const speedPct = 1 - distFromEdge / autoscrollThreshold!;\n    const offset = speedPct * autoscrollSpeed;\n    const targetOffset = isAtTopEdge.value\n      ? Math.max(0, scrollOffset.value - offset)\n      : Math.min(\n          scrollOffset.value + offset,\n          scrollViewSize.value - containerSize.value\n        );\n\n    scrollTarget.value = targetOffset;\n    // Reanimated scrollTo is crashing on android. use 'regular' scrollTo until figured out.\n    // scrollTo(scrollViewRef, targetX, targetY, true);\n    runOnJS(scrollToInternal)(targetOffset);\n  }, []);\n\n  return null;\n}\n"],"mappings":"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"}