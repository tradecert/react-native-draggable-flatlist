{"version":3,"names":["React","useRef","useState","LogBox","useDerivedValue","useSharedValue","DraggableFlatList","useSafeNestableScrollContainerContext","useNestedAutoScroll","useStableCallback","NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","current","ignoreLogs","console","reportErrorsAsExceptions","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","animVals","setAnimVals","defaultHoverOffset","listHoverOffset","setListHoverOffset","hoverOffset","value","onListContainerLayout","containerRef","nodeHandle","onSuccess","_x","y","onFail","log","measureLayout","onDragBegin","params","onDragEnd","onAnimValInit","activationDistance","NestableDraggableFlatList","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { LogBox } from \"react-native\";\nimport { FlatList } from \"react-native-gesture-handler\";\n// Animated is needed as an import to generate types for Animated.View which are used inside this\nimport Animated, { useDerivedValue, useSharedValue } from \"react-native-reanimated\";\nimport DraggableFlatList from \"../components/DraggableFlatList\";\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\nimport { DraggableFlatListProps } from \"../types\";\n\nfunction NestableDraggableFlatListInner<T>(props: DraggableFlatListProps<T>, ref?: React.ForwardedRef<FlatList<T>>) {\n  const hasSuppressedWarnings = useRef(false);\n\n  if (!hasSuppressedWarnings.current) {\n    LogBox.ignoreLogs([\n      \"VirtualizedLists should never be nested inside plain ScrollViews with the same orientation because it can break windowing\",\n    ]); // Ignore log notification by message\n    //@ts-ignore\n    console.reportErrorsAsExceptions = false;\n    hasSuppressedWarnings.current = true;\n  }\n\n  const { scrollableRef, outerScrollOffset, setOuterScrollEnabled } = useSafeNestableScrollContainerContext();\n\n  const listVerticalOffset = useSharedValue(0);\n  const [animVals, setAnimVals] = useState({});\n  const defaultHoverOffset = useSharedValue(0);\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\n\n  const hoverOffset = useDerivedValue(() => {\n    return listHoverOffset.value + listVerticalOffset.value;\n  }, [listHoverOffset]);\n\n  useNestedAutoScroll({\n    ...animVals,\n    hoverOffset,\n  });\n\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\n    const nodeHandle = scrollableRef.current;\n\n    const onSuccess = (_x: number, y: number) => {\n      listVerticalOffset.value = y;\n    };\n    const onFail = () => {\n      console.log(\"## nested draggable list measure fail\");\n    };\n    //@ts-ignore\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\n  });\n\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback((params) => {\n    setOuterScrollEnabled(false);\n    props.onDragBegin?.(params);\n  });\n\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback((params) => {\n    setOuterScrollEnabled(true);\n    props.onDragEnd?.(params);\n  });\n\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback((params) => {\n    setListHoverOffset(params.hoverOffset);\n    setAnimVals({\n      ...params,\n      hoverOffset,\n    });\n    props.onAnimValInit?.(params);\n  });\n\n  return (\n    <DraggableFlatList\n      ref={ref}\n      onContainerLayout={onListContainerLayout}\n      activationDistance={props.activationDistance || 20}\n      scrollEnabled={false}\n      {...props}\n      outerScrollOffset={outerScrollOffset}\n      onDragBegin={onDragBegin}\n      onDragEnd={onDragEnd}\n      onAnimValInit={onAnimValInit}\n    />\n  );\n}\n\n// Generic forwarded ref type assertion taken from:\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\nexport const NestableDraggableFlatList = React.forwardRef(NestableDraggableFlatListInner) as <T>(\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\n) => ReturnType<typeof NestableDraggableFlatListInner>;\n"],"mappings":"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"}