{"version":3,"names":["runOnJS","useAnimatedReaction","useDerivedValue","useSharedValue","DEFAULT_PROPS","SCROLL_POSITION_TOLERANCE","useProps","useAnimatedValues","useRefs","useAutoScroll","flatlistRef","autoscrollThreshold","autoscrollSpeed","scrollOffset","scrollViewSize","containerSize","activeCellSize","hoverOffset","activeIndexAnim","touchTranslate","hoverScreenOffset","value","isScrolledUp","isScrolledDown","distToTopEdge","Math","max","distToBottomEdge","hoverPlusActiveCell","isAtTopEdge","isAtBottomEdge","scrollTarget","dragIsActive","cur","prev","shouldAutoScroll","scrollTargetDiff","abs","hasScrolledToTarget","isAtEdge","topDisabled","bottomDisabled","isEdgeDisabled","cellIsActive","hasMovedDrag","scrollToInternal","offset","current","scrollToOffset","animated","distFromEdge","speedPct","targetOffset","min"],"sources":["useAutoScroll.tsx"],"sourcesContent":["import { runOnJS, useAnimatedReaction, useDerivedValue, useSharedValue } from \"react-native-reanimated\";\nimport { DEFAULT_PROPS, SCROLL_POSITION_TOLERANCE } from \"../constants\";\nimport { useProps } from \"../context/propsContext\";\nimport { useAnimatedValues } from \"../context/animatedValueContext\";\nimport { useRefs } from \"../context/refContext\";\n\nexport function useAutoScroll() {\n  const { flatlistRef } = useRefs();\n\n  const {\n    autoscrollThreshold = DEFAULT_PROPS.autoscrollThreshold,\n    autoscrollSpeed = DEFAULT_PROPS.autoscrollSpeed,\n  } = useProps();\n\n  const {\n    scrollOffset,\n    scrollViewSize,\n    containerSize,\n    activeCellSize,\n    hoverOffset,\n    activeIndexAnim,\n    touchTranslate,\n  } = useAnimatedValues();\n\n  const hoverScreenOffset = useDerivedValue(() => {\n    return hoverOffset.value - scrollOffset.value;\n  }, []);\n\n  const isScrolledUp = useDerivedValue(() => {\n    return scrollOffset.value - SCROLL_POSITION_TOLERANCE <= 0;\n  }, []);\n\n  const isScrolledDown = useDerivedValue(() => {\n    return scrollOffset.value + containerSize.value + SCROLL_POSITION_TOLERANCE >= scrollViewSize.value;\n  }, []);\n\n  const distToTopEdge = useDerivedValue(() => {\n    return Math.max(0, hoverScreenOffset.value);\n  }, []);\n\n  const distToBottomEdge = useDerivedValue(() => {\n    const hoverPlusActiveCell = hoverScreenOffset.value + activeCellSize.value;\n    return Math.max(0, containerSize.value - hoverPlusActiveCell);\n  }, []);\n\n  const isAtTopEdge = useDerivedValue(() => {\n    return distToTopEdge.value <= autoscrollThreshold;\n  });\n\n  const isAtBottomEdge = useDerivedValue(() => {\n    return distToBottomEdge.value <= autoscrollThreshold;\n  }, []);\n\n  const scrollTarget = useSharedValue(0);\n  const dragIsActive = useDerivedValue(() => {\n    return activeIndexAnim.value >= 0;\n  }, []);\n\n  useAnimatedReaction(\n    () => {\n      return dragIsActive.value;\n    },\n    (cur, prev) => {\n      if (cur && !prev) {\n        scrollTarget.value = scrollOffset.value;\n      }\n    }\n  );\n\n  const shouldAutoScroll = useDerivedValue(() => {\n    const scrollTargetDiff = Math.abs(scrollTarget.value - scrollOffset.value);\n    const hasScrolledToTarget = scrollTargetDiff < SCROLL_POSITION_TOLERANCE;\n\n    const isAtEdge = isAtTopEdge.value || isAtBottomEdge.value;\n    const topDisabled = isAtTopEdge.value && isScrolledUp.value;\n    const bottomDisabled = isAtBottomEdge.value && isScrolledDown.value;\n    const isEdgeDisabled = topDisabled || bottomDisabled;\n\n    const cellIsActive = activeIndexAnim.value >= 0;\n\n    // Only enable auto-scroll if the user has actually moved the drag\n    // This prevents auto-scrolling when starting a drag near an edge\n    // Check touchTranslate (actual finger/mouse movement) not hoverAnim (which includes auto-scroll effects)\n    const hasMovedDrag = Math.abs(touchTranslate.value) > 1;\n\n    return hasScrolledToTarget && isAtEdge && !isEdgeDisabled && cellIsActive && hasMovedDrag;\n  }, []);\n\n  function scrollToInternal(offset: number) {\n    if (flatlistRef && \"current\" in flatlistRef) {\n      flatlistRef.current?.scrollToOffset({ offset, animated: true });\n    }\n  }\n\n  useDerivedValue(() => {\n    if (!shouldAutoScroll.value) return;\n\n    const distFromEdge = isAtTopEdge.value ? distToTopEdge.value : distToBottomEdge.value;\n    const speedPct = 1 - distFromEdge / autoscrollThreshold!;\n    const offset = speedPct * autoscrollSpeed;\n    const targetOffset = isAtTopEdge.value\n      ? Math.max(0, scrollOffset.value - offset)\n      : Math.min(scrollOffset.value + offset, scrollViewSize.value - containerSize.value);\n\n    scrollTarget.value = targetOffset;\n    // Reanimated scrollTo is crashing on android. use 'regular' scrollTo until figured out.\n    // scrollTo(scrollViewRef, targetX, targetY, true);\n    runOnJS(scrollToInternal)(targetOffset);\n  }, []);\n\n  return null;\n}\n"],"mappings":"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"}